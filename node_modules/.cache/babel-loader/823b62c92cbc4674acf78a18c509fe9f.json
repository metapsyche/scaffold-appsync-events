{"ast":null,"code":"\"use strict\";\n\nvar __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    };\n\n    return extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nvar __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n/*!\n * Copyright 2017-2017 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n * SPDX-License-Identifier: Apache-2.0\n */\n\nvar utils_1 = require(\"../utils\");\n\nvar apollo_cache_inmemory_1 = require(\"apollo-cache-inmemory\");\n\nexports.defaultDataIdFromObject = apollo_cache_inmemory_1.defaultDataIdFromObject;\n\nvar deltaSync_1 = require(\"../deltaSync\");\n\nvar logger = utils_1.rootLogger.extend('offline-cache'); // Offline schema keys: Do not change in a non-backwards-compatible way\n\nexports.NORMALIZED_CACHE_KEY = 'appsync';\nexports.METADATA_KEY = 'appsync-metadata';\nvar WRITE_CACHE_ACTION = 'AAS_WRITE_CACHE';\n\nfunction isOfflineCacheOptions(obj) {\n  return !!obj.store;\n}\n\n;\n\nvar MyCache =\n/** @class */\nfunction (_super) {\n  __extends(MyCache, _super);\n\n  function MyCache(optionsOrStore, config) {\n    if (config === void 0) {\n      config = {};\n    }\n\n    var _this = _super.call(this, config) || this;\n\n    _this.storeCacheRootMutation = false;\n\n    if (isOfflineCacheOptions(optionsOrStore)) {\n      var store = optionsOrStore.store,\n          _a = optionsOrStore.storeCacheRootMutation,\n          storeCacheRootMutation = _a === void 0 ? false : _a;\n      _this.store = store;\n      _this.storeCacheRootMutation = storeCacheRootMutation;\n    } else {\n      _this.store = optionsOrStore;\n    }\n\n    var cancelSubscription = _this.store.subscribe(function () {\n      var _a = _this.store.getState(),\n          _b = exports.NORMALIZED_CACHE_KEY,\n          _c = _a[_b],\n          normCache = _c === void 0 ? {} : _c,\n          _d = _a.rehydrated,\n          rehydrated = _d === void 0 ? false : _d;\n\n      _super.prototype.restore.call(_this, __assign({}, normCache));\n\n      if (rehydrated) {\n        logger('Rehydrated! Cancelling subscription.');\n        cancelSubscription();\n      }\n    });\n\n    return _this;\n  }\n\n  MyCache.prototype.restore = function (data) {\n    boundWriteCache(this.store, data);\n\n    _super.prototype.restore.call(this, data);\n\n    _super.prototype.broadcastWatches.call(this);\n\n    return this;\n  };\n\n  MyCache.prototype.write = function (write) {\n    _super.prototype.write.call(this, write);\n\n    if (!this.storeCacheRootMutation && write.dataId === 'ROOT_MUTATION') {\n      this.data.delete('ROOT_MUTATION');\n    }\n\n    if (this.data && typeof this.data.record === 'undefined') {\n      // do not persist contents of a RecordingCache\n      var data = _super.prototype.extract.call(this, true);\n\n      boundWriteCache(this.store, data);\n    } else {\n      logger('No dispatch for RecordingCache');\n    }\n  };\n\n  MyCache.prototype.reset = function () {\n    logger('Resetting cache');\n    boundWriteCache(this.store, {});\n    return _super.prototype.reset.call(this);\n  };\n\n  MyCache.prototype.getIdsMap = function () {\n    var _a = exports.METADATA_KEY,\n        idsMap = this.store.getState()[_a].idsMap;\n\n    return __assign({}, idsMap);\n  };\n\n  return MyCache;\n}(apollo_cache_inmemory_1.InMemoryCache);\n\nexports.default = MyCache;\n\nvar boundWriteCache = function (store, data) {\n  logger(\"Dispatching \" + WRITE_CACHE_ACTION);\n  store.dispatch(writeThunk(WRITE_CACHE_ACTION, data));\n};\n\nvar writeThunk = function (type, payload) {\n  return function (dispatch, _getState) {\n    return dispatch({\n      type: type,\n      payload: payload\n    });\n  };\n};\n\nexports.reducer = function () {\n  var _a;\n\n  return _a = {}, _a[exports.NORMALIZED_CACHE_KEY] = function (state, action) {\n    if (state === void 0) {\n      state = {};\n    }\n\n    var type = action.type,\n        normCache = action.payload;\n\n    switch (type) {\n      case WRITE_CACHE_ACTION:\n        return __assign({}, normCache);\n\n      default:\n        return state;\n    }\n  }, _a;\n};","map":{"version":3,"names":["__extends","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","hasOwnProperty","__","constructor","prototype","create","__assign","assign","t","s","i","n","arguments","length","call","apply","defineProperty","exports","value","utils_1","require","apollo_cache_inmemory_1","defaultDataIdFromObject","deltaSync_1","logger","rootLogger","extend","NORMALIZED_CACHE_KEY","METADATA_KEY","WRITE_CACHE_ACTION","isOfflineCacheOptions","obj","store","MyCache","_super","optionsOrStore","config","_this","storeCacheRootMutation","_a","cancelSubscription","subscribe","getState","_b","_c","normCache","_d","rehydrated","restore","data","boundWriteCache","broadcastWatches","write","dataId","delete","record","extract","reset","getIdsMap","idsMap","InMemoryCache","default","dispatch","writeThunk","type","payload","_getState","reducer","state","action"],"sources":["/Users/roaldmaravillas/ro/github/scaffold-appsync-events/node_modules/aws-appsync/lib/cache/offline-cache.js"],"sourcesContent":["\"use strict\";\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\n/*!\n * Copyright 2017-2017 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n * SPDX-License-Identifier: Apache-2.0\n */\nvar utils_1 = require(\"../utils\");\nvar apollo_cache_inmemory_1 = require(\"apollo-cache-inmemory\");\nexports.defaultDataIdFromObject = apollo_cache_inmemory_1.defaultDataIdFromObject;\nvar deltaSync_1 = require(\"../deltaSync\");\nvar logger = utils_1.rootLogger.extend('offline-cache');\n// Offline schema keys: Do not change in a non-backwards-compatible way\nexports.NORMALIZED_CACHE_KEY = 'appsync';\nexports.METADATA_KEY = 'appsync-metadata';\nvar WRITE_CACHE_ACTION = 'AAS_WRITE_CACHE';\nfunction isOfflineCacheOptions(obj) {\n    return !!obj.store;\n}\n;\nvar MyCache = /** @class */ (function (_super) {\n    __extends(MyCache, _super);\n    function MyCache(optionsOrStore, config) {\n        if (config === void 0) { config = {}; }\n        var _this = _super.call(this, config) || this;\n        _this.storeCacheRootMutation = false;\n        if (isOfflineCacheOptions(optionsOrStore)) {\n            var store = optionsOrStore.store, _a = optionsOrStore.storeCacheRootMutation, storeCacheRootMutation = _a === void 0 ? false : _a;\n            _this.store = store;\n            _this.storeCacheRootMutation = storeCacheRootMutation;\n        }\n        else {\n            _this.store = optionsOrStore;\n        }\n        var cancelSubscription = _this.store.subscribe(function () {\n            var _a = _this.store.getState(), _b = exports.NORMALIZED_CACHE_KEY, _c = _a[_b], normCache = _c === void 0 ? {} : _c, _d = _a.rehydrated, rehydrated = _d === void 0 ? false : _d;\n            _super.prototype.restore.call(_this, __assign({}, normCache));\n            if (rehydrated) {\n                logger('Rehydrated! Cancelling subscription.');\n                cancelSubscription();\n            }\n        });\n        return _this;\n    }\n    MyCache.prototype.restore = function (data) {\n        boundWriteCache(this.store, data);\n        _super.prototype.restore.call(this, data);\n        _super.prototype.broadcastWatches.call(this);\n        return this;\n    };\n    MyCache.prototype.write = function (write) {\n        _super.prototype.write.call(this, write);\n        if (!this.storeCacheRootMutation && write.dataId === 'ROOT_MUTATION') {\n            this.data.delete('ROOT_MUTATION');\n        }\n        if (this.data && typeof this.data.record === 'undefined') {\n            // do not persist contents of a RecordingCache\n            var data = _super.prototype.extract.call(this, true);\n            boundWriteCache(this.store, data);\n        }\n        else {\n            logger('No dispatch for RecordingCache');\n        }\n    };\n    MyCache.prototype.reset = function () {\n        logger('Resetting cache');\n        boundWriteCache(this.store, {});\n        return _super.prototype.reset.call(this);\n    };\n    MyCache.prototype.getIdsMap = function () {\n        var _a = exports.METADATA_KEY, idsMap = this.store.getState()[_a].idsMap;\n        return __assign({}, idsMap);\n    };\n    return MyCache;\n}(apollo_cache_inmemory_1.InMemoryCache));\nexports.default = MyCache;\nvar boundWriteCache = function (store, data) {\n    logger(\"Dispatching \" + WRITE_CACHE_ACTION);\n    store.dispatch(writeThunk(WRITE_CACHE_ACTION, data));\n};\nvar writeThunk = function (type, payload) { return function (dispatch, _getState) { return dispatch({\n    type: type,\n    payload: payload,\n}); }; };\nexports.reducer = function () {\n    var _a;\n    return (_a = {},\n        _a[exports.NORMALIZED_CACHE_KEY] = function (state, action) {\n            if (state === void 0) { state = {}; }\n            var type = action.type, normCache = action.payload;\n            switch (type) {\n                case WRITE_CACHE_ACTION:\n                    return __assign({}, normCache);\n                default:\n                    return state;\n            }\n        },\n        _a);\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}