{"ast":null,"code":"import { argumentsObjectFromField } from './storeUtils';\nexport function getDirectiveInfoFromField(field, variables) {\n  if (field.directives && field.directives.length) {\n    var directiveObj_1 = {};\n    field.directives.forEach(function (directive) {\n      directiveObj_1[directive.name.value] = argumentsObjectFromField(directive, variables);\n    });\n    return directiveObj_1;\n  }\n\n  return null;\n}\nexport function shouldInclude(selection, variables) {\n  if (variables === void 0) {\n    variables = {};\n  }\n\n  if (!selection.directives) {\n    return true;\n  }\n\n  var res = true;\n  selection.directives.forEach(function (directive) {\n    if (directive.name.value !== 'skip' && directive.name.value !== 'include') {\n      return;\n    }\n\n    var directiveArguments = directive.arguments || [];\n    var directiveName = directive.name.value;\n\n    if (directiveArguments.length !== 1) {\n      throw new Error(\"Incorrect number of arguments for the @\" + directiveName + \" directive.\");\n    }\n\n    var ifArgument = directiveArguments[0];\n\n    if (!ifArgument.name || ifArgument.name.value !== 'if') {\n      throw new Error(\"Invalid argument for the @\" + directiveName + \" directive.\");\n    }\n\n    var ifValue = directiveArguments[0].value;\n    var evaledValue = false;\n\n    if (!ifValue || ifValue.kind !== 'BooleanValue') {\n      if (ifValue.kind !== 'Variable') {\n        throw new Error(\"Argument for the @\" + directiveName + \" directive must be a variable or a boolean value.\");\n      } else {\n        evaledValue = variables[ifValue.name.value];\n\n        if (evaledValue === undefined) {\n          throw new Error(\"Invalid variable referenced in @\" + directiveName + \" directive.\");\n        }\n      }\n    } else {\n      evaledValue = ifValue.value;\n    }\n\n    if (directiveName === 'skip') {\n      evaledValue = !evaledValue;\n    }\n\n    if (!evaledValue) {\n      res = false;\n    }\n  });\n  return res;\n}\nexport function flattenSelections(selection) {\n  if (!selection.selectionSet || !(selection.selectionSet.selections.length > 0)) return [selection];\n  return [selection].concat(selection.selectionSet.selections.map(function (selectionNode) {\n    return [selectionNode].concat(flattenSelections(selectionNode));\n  }).reduce(function (selections, selected) {\n    return selections.concat(selected);\n  }, []));\n}\nexport function getDirectiveNames(doc) {\n  var directiveNames = doc.definitions.filter(function (definition) {\n    return definition.selectionSet && definition.selectionSet.selections;\n  }).map(function (x) {\n    return flattenSelections(x);\n  }).reduce(function (selections, selected) {\n    return selections.concat(selected);\n  }, []).filter(function (selection) {\n    return selection.directives && selection.directives.length > 0;\n  }).map(function (selection) {\n    return selection.directives;\n  }).reduce(function (directives, directive) {\n    return directives.concat(directive);\n  }, []).map(function (directive) {\n    return directive.name.value;\n  });\n  return directiveNames;\n}\nexport function hasDirectives(names, doc) {\n  return getDirectiveNames(doc).some(function (name) {\n    return names.indexOf(name) > -1;\n  });\n}","map":{"version":3,"sources":["../src/directives.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["import { argumentsObjectFromField } from './storeUtils';\nexport function getDirectiveInfoFromField(field, variables) {\n    if (field.directives && field.directives.length) {\n        var directiveObj_1 = {};\n        field.directives.forEach(function (directive) {\n            directiveObj_1[directive.name.value] = argumentsObjectFromField(directive, variables);\n        });\n        return directiveObj_1;\n    }\n    return null;\n}\nexport function shouldInclude(selection, variables) {\n    if (variables === void 0) { variables = {}; }\n    if (!selection.directives) {\n        return true;\n    }\n    var res = true;\n    selection.directives.forEach(function (directive) {\n        if (directive.name.value !== 'skip' && directive.name.value !== 'include') {\n            return;\n        }\n        var directiveArguments = directive.arguments || [];\n        var directiveName = directive.name.value;\n        if (directiveArguments.length !== 1) {\n            throw new Error(\"Incorrect number of arguments for the @\" + directiveName + \" directive.\");\n        }\n        var ifArgument = directiveArguments[0];\n        if (!ifArgument.name || ifArgument.name.value !== 'if') {\n            throw new Error(\"Invalid argument for the @\" + directiveName + \" directive.\");\n        }\n        var ifValue = directiveArguments[0].value;\n        var evaledValue = false;\n        if (!ifValue || ifValue.kind !== 'BooleanValue') {\n            if (ifValue.kind !== 'Variable') {\n                throw new Error(\"Argument for the @\" + directiveName + \" directive must be a variable or a boolean value.\");\n            }\n            else {\n                evaledValue = variables[ifValue.name.value];\n                if (evaledValue === undefined) {\n                    throw new Error(\"Invalid variable referenced in @\" + directiveName + \" directive.\");\n                }\n            }\n        }\n        else {\n            evaledValue = ifValue.value;\n        }\n        if (directiveName === 'skip') {\n            evaledValue = !evaledValue;\n        }\n        if (!evaledValue) {\n            res = false;\n        }\n    });\n    return res;\n}\nexport function flattenSelections(selection) {\n    if (!selection.selectionSet ||\n        !(selection.selectionSet.selections.length > 0))\n        return [selection];\n    return [selection].concat(selection.selectionSet.selections\n        .map(function (selectionNode) {\n        return [selectionNode].concat(flattenSelections(selectionNode));\n    })\n        .reduce(function (selections, selected) { return selections.concat(selected); }, []));\n}\nexport function getDirectiveNames(doc) {\n    var directiveNames = doc.definitions\n        .filter(function (definition) {\n        return definition.selectionSet && definition.selectionSet.selections;\n    })\n        .map(function (x) { return flattenSelections(x); })\n        .reduce(function (selections, selected) { return selections.concat(selected); }, [])\n        .filter(function (selection) {\n        return selection.directives && selection.directives.length > 0;\n    })\n        .map(function (selection) { return selection.directives; })\n        .reduce(function (directives, directive) { return directives.concat(directive); }, [])\n        .map(function (directive) { return directive.name.value; });\n    return directiveNames;\n}\nexport function hasDirectives(names, doc) {\n    return getDirectiveNames(doc).some(function (name) { return names.indexOf(name) > -1; });\n}\n//# sourceMappingURL=directives.js.map"]},"metadata":{},"sourceType":"module"}