{"ast":null,"code":"var __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nimport { QueryDocumentKeys } from \"graphql/language/visitor\";\nvar CIRCULAR = Object.create(null);\nvar objToStr = Object.prototype.toString;\n\nvar QueryKeyMaker = function () {\n  function QueryKeyMaker(cacheKeyRoot) {\n    this.cacheKeyRoot = cacheKeyRoot;\n    this.perQueryKeyMakers = new Map();\n  }\n\n  QueryKeyMaker.prototype.forQuery = function (document) {\n    if (!this.perQueryKeyMakers.has(document)) {\n      this.perQueryKeyMakers.set(document, new PerQueryKeyMaker(this.cacheKeyRoot, document));\n    }\n\n    return this.perQueryKeyMakers.get(document);\n  };\n\n  return QueryKeyMaker;\n}();\n\nexport { QueryKeyMaker };\n\nvar PerQueryKeyMaker = function () {\n  function PerQueryKeyMaker(cacheKeyRoot, query) {\n    this.cacheKeyRoot = cacheKeyRoot;\n    this.query = query;\n    this.cache = new Map();\n    this.lookupArray = this.cacheMethod(this.lookupArray);\n    this.lookupObject = this.cacheMethod(this.lookupObject);\n    this.lookupFragmentSpread = this.cacheMethod(this.lookupFragmentSpread);\n  }\n\n  PerQueryKeyMaker.prototype.cacheMethod = function (method) {\n    var _this = this;\n\n    return function (value) {\n      if (_this.cache.has(value)) {\n        var cached = _this.cache.get(value);\n\n        if (cached === CIRCULAR) {\n          throw new Error(\"QueryKeyMaker cannot handle circular query structures\");\n        }\n\n        return cached;\n      }\n\n      _this.cache.set(value, CIRCULAR);\n\n      try {\n        var result = method.call(_this, value);\n\n        _this.cache.set(value, result);\n\n        return result;\n      } catch (e) {\n        _this.cache.delete(value);\n\n        throw e;\n      }\n    };\n  };\n\n  PerQueryKeyMaker.prototype.lookupQuery = function (document) {\n    return this.lookupObject(document);\n  };\n\n  PerQueryKeyMaker.prototype.lookupSelectionSet = function (selectionSet) {\n    return this.lookupObject(selectionSet);\n  };\n\n  PerQueryKeyMaker.prototype.lookupFragmentSpread = function (fragmentSpread) {\n    var name = fragmentSpread.name.value;\n    var fragment = null;\n    this.query.definitions.some(function (definition) {\n      if (definition.kind === \"FragmentDefinition\" && definition.name.value === name) {\n        fragment = definition;\n        return true;\n      }\n\n      return false;\n    });\n    return this.lookupObject(__assign({}, fragmentSpread, {\n      fragment: fragment\n    }));\n  };\n\n  PerQueryKeyMaker.prototype.lookupAny = function (value) {\n    if (Array.isArray(value)) {\n      return this.lookupArray(value);\n    }\n\n    if (typeof value === \"object\" && value !== null) {\n      if (value.kind === \"FragmentSpread\") {\n        return this.lookupFragmentSpread(value);\n      }\n\n      return this.lookupObject(value);\n    }\n\n    return value;\n  };\n\n  PerQueryKeyMaker.prototype.lookupArray = function (array) {\n    var elements = array.map(this.lookupAny, this);\n    return this.cacheKeyRoot.lookup(objToStr.call(array), this.cacheKeyRoot.lookupArray(elements));\n  };\n\n  PerQueryKeyMaker.prototype.lookupObject = function (object) {\n    var _this = this;\n\n    var keys = safeSortedKeys(object);\n    var values = keys.map(function (key) {\n      return _this.lookupAny(object[key]);\n    });\n    return this.cacheKeyRoot.lookup(objToStr.call(object), this.cacheKeyRoot.lookupArray(keys), this.cacheKeyRoot.lookupArray(values));\n  };\n\n  return PerQueryKeyMaker;\n}();\n\nvar queryKeyMap = Object.create(null);\nObject.keys(QueryDocumentKeys).forEach(function (parentKind) {\n  var childKeys = queryKeyMap[parentKind] = Object.create(null);\n  QueryDocumentKeys[parentKind].forEach(function (childKey) {\n    childKeys[childKey] = true;\n  });\n\n  if (parentKind === \"FragmentSpread\") {\n    childKeys[\"fragment\"] = true;\n  }\n});\n\nfunction safeSortedKeys(object) {\n  var keys = Object.keys(object);\n  var keyCount = keys.length;\n  var knownKeys = typeof object.kind === \"string\" && queryKeyMap[object.kind];\n  var target = 0;\n\n  for (var source = target; source < keyCount; ++source) {\n    var key = keys[source];\n    var value = object[key];\n    var isObjectOrArray = value !== null && typeof value === \"object\";\n\n    if (!isObjectOrArray || !knownKeys || knownKeys[key] === true) {\n      keys[target++] = key;\n    }\n  }\n\n  keys.length = target;\n  return keys.sort();\n}","map":{"version":3,"sources":["../src/queryKeyMaker.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["var __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nimport { QueryDocumentKeys } from \"graphql/language/visitor\";\nvar CIRCULAR = Object.create(null);\nvar objToStr = Object.prototype.toString;\nvar QueryKeyMaker = (function () {\n    function QueryKeyMaker(cacheKeyRoot) {\n        this.cacheKeyRoot = cacheKeyRoot;\n        this.perQueryKeyMakers = new Map();\n    }\n    QueryKeyMaker.prototype.forQuery = function (document) {\n        if (!this.perQueryKeyMakers.has(document)) {\n            this.perQueryKeyMakers.set(document, new PerQueryKeyMaker(this.cacheKeyRoot, document));\n        }\n        return this.perQueryKeyMakers.get(document);\n    };\n    return QueryKeyMaker;\n}());\nexport { QueryKeyMaker };\nvar PerQueryKeyMaker = (function () {\n    function PerQueryKeyMaker(cacheKeyRoot, query) {\n        this.cacheKeyRoot = cacheKeyRoot;\n        this.query = query;\n        this.cache = new Map;\n        this.lookupArray = this.cacheMethod(this.lookupArray);\n        this.lookupObject = this.cacheMethod(this.lookupObject);\n        this.lookupFragmentSpread = this.cacheMethod(this.lookupFragmentSpread);\n    }\n    PerQueryKeyMaker.prototype.cacheMethod = function (method) {\n        var _this = this;\n        return function (value) {\n            if (_this.cache.has(value)) {\n                var cached = _this.cache.get(value);\n                if (cached === CIRCULAR) {\n                    throw new Error(\"QueryKeyMaker cannot handle circular query structures\");\n                }\n                return cached;\n            }\n            _this.cache.set(value, CIRCULAR);\n            try {\n                var result = method.call(_this, value);\n                _this.cache.set(value, result);\n                return result;\n            }\n            catch (e) {\n                _this.cache.delete(value);\n                throw e;\n            }\n        };\n    };\n    PerQueryKeyMaker.prototype.lookupQuery = function (document) {\n        return this.lookupObject(document);\n    };\n    PerQueryKeyMaker.prototype.lookupSelectionSet = function (selectionSet) {\n        return this.lookupObject(selectionSet);\n    };\n    PerQueryKeyMaker.prototype.lookupFragmentSpread = function (fragmentSpread) {\n        var name = fragmentSpread.name.value;\n        var fragment = null;\n        this.query.definitions.some(function (definition) {\n            if (definition.kind === \"FragmentDefinition\" &&\n                definition.name.value === name) {\n                fragment = definition;\n                return true;\n            }\n            return false;\n        });\n        return this.lookupObject(__assign({}, fragmentSpread, { fragment: fragment }));\n    };\n    PerQueryKeyMaker.prototype.lookupAny = function (value) {\n        if (Array.isArray(value)) {\n            return this.lookupArray(value);\n        }\n        if (typeof value === \"object\" && value !== null) {\n            if (value.kind === \"FragmentSpread\") {\n                return this.lookupFragmentSpread(value);\n            }\n            return this.lookupObject(value);\n        }\n        return value;\n    };\n    PerQueryKeyMaker.prototype.lookupArray = function (array) {\n        var elements = array.map(this.lookupAny, this);\n        return this.cacheKeyRoot.lookup(objToStr.call(array), this.cacheKeyRoot.lookupArray(elements));\n    };\n    PerQueryKeyMaker.prototype.lookupObject = function (object) {\n        var _this = this;\n        var keys = safeSortedKeys(object);\n        var values = keys.map(function (key) { return _this.lookupAny(object[key]); });\n        return this.cacheKeyRoot.lookup(objToStr.call(object), this.cacheKeyRoot.lookupArray(keys), this.cacheKeyRoot.lookupArray(values));\n    };\n    return PerQueryKeyMaker;\n}());\nvar queryKeyMap = Object.create(null);\nObject.keys(QueryDocumentKeys).forEach(function (parentKind) {\n    var childKeys = queryKeyMap[parentKind] = Object.create(null);\n    QueryDocumentKeys[parentKind].forEach(function (childKey) {\n        childKeys[childKey] = true;\n    });\n    if (parentKind === \"FragmentSpread\") {\n        childKeys[\"fragment\"] = true;\n    }\n});\nfunction safeSortedKeys(object) {\n    var keys = Object.keys(object);\n    var keyCount = keys.length;\n    var knownKeys = typeof object.kind === \"string\" && queryKeyMap[object.kind];\n    var target = 0;\n    for (var source = target; source < keyCount; ++source) {\n        var key = keys[source];\n        var value = object[key];\n        var isObjectOrArray = value !== null && typeof value === \"object\";\n        if (!isObjectOrArray || !knownKeys || knownKeys[key] === true) {\n            keys[target++] = key;\n        }\n    }\n    keys.length = target;\n    return keys.sort();\n}\n//# sourceMappingURL=queryKeyMaker.js.map"]},"metadata":{},"sourceType":"module"}